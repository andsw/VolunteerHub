<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="ca.ontario.conestoga.volunteer_hub.mapper.ExtendedEventMapper">


  <select id="getEventsWithVolunteerNum"
          resultType="ca.ontario.conestoga.volunteer_hub.others.vo.EventListItem">
    select a.*, o.id as organizationId, o.name as organizationname, ISNULL(vn.vn_num, 0) as joinedVolunteerNum
    from event a
        left join (select event_id, count(*) as vn_num
                   from participation_record pr
                   group by event_id) vn
        on vn.event_id = a.id
        left join organization o on a.organization_id = o.id
    <if test="host_id != null">
      where a.host_id = #{organizationId}
    </if>
  </select>
</mapper>